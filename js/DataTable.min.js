
    /**
     * Library DataTable
     * @author netcodev.de
     * @version 1.0
     * */
    
class DataTable
{constructor(containerId,config){this.setConfig(config);this.Search=new DataTableSearch();this.View=new DataTableView(this,this.config);this.Toolbar=new DataTableToolBar(this,this.config);this.config.dom.container=document.getElementById(containerId);for(let key in this.config.domId){this.config.dom[key]=this.config.dom.container.getElementsByClassName(this.config.domId[key])[0]}
this.setRequest()}
setConfig=(config)=>{const defaultConf={dataTable:[],dataTableCache:[],dataTableClone:"",dataIndex:0,dataConfig:{dataStep:1,maxStep:0,maxLen:0,stepLen:0,actualLen:0,rowLen:0,},arrToggleList:[],arrRowList:[],arrRowIndex:[],objSortList:{},ajaxUrlFilter:[],dom:{container:null},domId:{btnNext:'btn-step-forward',btnBack:'btn-step-back',btnStep:'btn-step',btnShowList:'btn-show-list',btnShowSelct:'btn-show-selection',btnContLen:'btn-content-length',btnConlToggle:'btn-col-toggle',contentInfo:'dataTable-content-info',maxStep:'dataTable-max-step',colToggleList:'dataTable-col-toggle-list',inptContentLength:'inpt-content-length',inptStep:'inpt-step',wrapper:'dataTable-wrapper',header:'dataTable-header',content:'dataTable-content',colToggleWrapper:'dataTable-col-toggle-wrapper'},tpl:{"columnHeader":'<div class="col-header-wrapper"><div class="col-header-label">{%column%}</div><div class="order-box-container"><span class="svg-arrow-item" data-arrow-id="up"><svg class="svg-arrow" viewBox="0 0 640 640" width="10" height="10"><defs><path d="M160.01 320.01L0.02 640.02L320.03 640.01L640.02 640L480.03 320L320.01 0.01L160.01 320.01Z" id="bbbJpxd7D"></path></defs><g><g><g><use xlink:href="#bbbJpxd7D" opacity="1" fill="#30bf2d" fill-opacity="1"></use><g><use xlink:href="#bbbJpxd7D" opacity="1" fill-opacity="0" stroke="#42413f" stroke-width="1" stroke-opacity="1"></use></g></g></g></g></svg></span><span class="svg-arrow-item" data-arrow-id="down"><svg class="svg-arrow" viewBox="0 0 640 640" width="10" height="10"><defs><path d="M480.02 320L640 0L320 0.01L0 0.02L160 320.01L320.01 640.01L480.02 320Z" id="a4wj2R4nkY"></path></defs><g><g><g><use xlink:href="#a4wj2R4nkY" opacity="1" fill="#30bf2d" fill-opacity="1"></use><g><use xlink:href="#a4wj2R4nkY" opacity="1" fill-opacity="0" stroke="#42413f" stroke-width="1" stroke-opacity="1"></use></g></g></g></g></svg></span></div></div>',"columnSearch":'<input type="text" value="" placeholder="Suchbegriff eingeben.."/><br/><button class="btn-search">Suche</button><br/>',"columnToggleList":'<span>{%column%}</span><input type="radio" checked="checked"/>',"rowIndex":'<span class="rowIndex">{%rowIndex%}</span>',}};this.config={...defaultConf,...config}}
setRequest=(act="")=>{const url=(!act)?this.config.ajaxUrl:this.config.ajaxUrl+"?"+act;this.config.dom.wrapper.scrollTop=0;fetch(url,{headers:{"Content-Type":"application/json; charset=utf-8"}}).then(res=>res.json()).then(res=>{this.setDataTable(res.dataTable)}).catch((error)=>console.error(error))};setDataTable=(dataTable)=>{this.config.dataIndex=0;if(dataTable.hasOwnProperty('header')&&dataTable.header.length){const width=(this.config.domAttr.colWidth*dataTable.header.length)+this.config.domAttr.mnWidth;this.View.setHeader(dataTable.header);this.setHeaderEvent();this.Toolbar.setToolbarEvent()}else{if(this.config.dom.header.querySelectorAll('.svg-arrow-item.active').length){this.config.dom.header.querySelectorAll('.svg-arrow-item.active')[0].setAttribute('class','svg-arrow-item')}}
this.setDataConfig(dataTable);this.setDataTableContent(dataTable.content);this.Toolbar.setToolbarInfo();this.Search._config={"dataTable":dataTable.content};this.config.dataTableClone=this.config.dom.content.innerHTML;this.config.dataTableCache=dataTable.content};setDataTableContent=(dataTable)=>{this.config.dataIndex=0;this.config.dom.content.innerHTML="";dataTable.map(this.View.setContent);this.setContentEvent()};setDataTableCache=(reset=!1)=>{if(reset){this.config.dataTable=this.config.dataTableCache;this.Search._config={"dataTable":this.config.dataTable};this.config.dom.content.innerHTML=this.config.dataTableClone;this.View.resetOrder();this.setContentEvent()}else{if(this.config.arrRowList.length){const dataTable=[];this.config.arrRowList.map((val)=>{dataTable.push(this.config.dataTable[val*1])});this.config.arrRowList=[];this.config.arrRowIndex=[];this.View.resetOrder();this.setDataTableContent(dataTable);this.Search._config={"dataTable":dataTable};this.config.dataTable=dataTable}else{alert("Keine markierten Daten gefunden.")}}};setSortDataTable=(index,obj)=>{this.config.objSortList={};this.config.objSortList['sortId_'+index]=obj.dataset.arrowId;this.Search._config={content:this.config.dom.content};const dataTable=this.Search.getSort(index,obj.dataset.arrowId);this.config.arrRowIndex=dataTable.arrRowIndex;if(this.config.dom.header.querySelectorAll('.svg-arrow-item.active').length){this.config.dom.header.querySelectorAll('.svg-arrow-item.active')[0].setAttribute('class','svg-arrow-item')}
obj.setAttribute('class','svg-arrow-item active');this.setDataTableContent(dataTable.arrRes)};setSearchDataTable=(obj)=>{const value=obj.parentElement.getElementsByTagName("input")[0].value.trim();if(value){this.Search._config={content:this.config.dom.content};const searchRes=this.Search.getSearch(obj.parentElement.parentElement.dataset.colIndex,value,this.config.dom.content);if(searchRes.length){this.View.setContentUpdate(searchRes)}else{alert("Kein Ergebniss gefunden fÃ¼r: "+value)}}else{alert('Kein Suchbegriff gefunden.')}};setDataConfig=(dataTable)=>{for(let key in this.config.dataConfig){if(dataTable.hasOwnProperty(key)){this.config.dataConfig[key]=dataTable[key]}}
this.config.dataTable=dataTable.content;this.config.objSortList={};this.config.arrRowIndex=[]};setAjaxUrlFilter=(key,val)=>{if(this.config.ajaxUrlFilter.length){let index=0;this.config.ajaxUrlFilter.map((filter)=>{if(filter.search(key)!==-1){this.config.ajaxUrlFilter.splice(index,1);return!1}
index++})}
this.config.ajaxUrlFilter.push(key+"="+val)};setHeaderEvent=()=>{const listColHeader=this.config.dom.header.getElementsByClassName("col-header");const View=this.View;for(let col=0;col<listColHeader.length;col++){listColHeader[col].addEventListener("mouseenter",function(e){View.setColumnSearch(this,e.type)});listColHeader[col].addEventListener("mouseleave",function(e){View.setColumnSearch(this,e.type)});listColHeader[col].querySelectorAll('.svg-arrow-item').forEach((obj)=>{const index=listColHeader[col].dataset.colIndex;obj.onclick=()=>{this.setSortDataTable(index,obj)}})}};setContentEvent=()=>{const rows=this.config.dom.content.getElementsByClassName("data-row");for(let i=0;i<rows.length;i++){rows[i].onclick=()=>{if(rows[i].classList.contains('active')){let index=0;this.config.arrRowList.map((val)=>{if(val===rows[i].dataset.rowIndex){this.config.arrRowList.splice(index,1);return!1}
index++})}else{this.config.arrRowList.push(rows[i].dataset.rowIndex)}
rows[i].classList.toggle('active')}}};setColToggleEvent=(obj)=>{const radio=obj.getElementsByTagName("input")[0];const status=(radio.getAttribute('checked'))?!0:!1;if(!status){radio.setAttribute('checked','checked');this.config.arrToggleList.splice(this.config.arrToggleList.indexOf(obj.dataset.colIndex),1)}else{radio.removeAttribute('checked');this.config.arrToggleList.push(obj.dataset.colIndex)}
this.View.setColumnUpdate(obj.dataset.colIndex,status)};setHeaderSearchEvent=()=>{this.config.dom.header.getElementsByClassName("btn-search")[0].onclick=(obj)=>{this.setSearchDataTable(obj.target)}}};class DataTableSearch
{constructor(){this.config={}}
getSearch=(colIndex,strSearch)=>{let result=[];let revertIndex=this.config.dataTable.length-1;colIndex=colIndex*1;for(let i=0;i<this.config.dataTable.length;i++){if(this.config.dataTable[i][colIndex]===strSearch){result.push(this.config.content.getElementsByClassName("data-row")[i].dataset.rowIndex*1)}
if(revertIndex>i){if(this.config.dataTable[revertIndex][colIndex]===strSearch){result.push(this.config.content.getElementsByClassName("data-row")[revertIndex].dataset.rowIndex*1)}
revertIndex--}
if(revertIndex===i){break}}
return result};getSort=(colIndex,order)=>{let arrRes=[];let arrIndex=[];let arrRowIndex=[];const asc=(order==='down')?1:0;for(let i=0;i<this.config.dataTable.length;i++){let rowId=this.config.content.getElementsByClassName("data-row")[i].dataset.rowIndex*1;arrIndex.push([rowId,this.config.dataTable[rowId][colIndex]])}
arrIndex=DataTableSort.getSort(arrIndex,asc);for(let n=0;n<arrIndex.length;n++){arrRes.push(this.config.dataTable[arrIndex[n][0]*1]);arrRowIndex.push(arrIndex[n][0]*1)}
return{arrRes:arrRes,arrRowIndex:arrRowIndex}};set _config(obj){this.config={...this.config,...obj}}};class DataTableSort
{static getStrNumber(i,str){let res="";let nextChar=null;let doIt=!0;while(doIt){res+=""+str[i];if(i+1<str.length&&/^[\d]$/.test(str[i+1])){i++}else{if(i+1<str.length){nextChar=str[i+1]}
doIt=!1}}
return{res:res,nextChar:nextChar}};static getSort(arr,orderAsc){let res=[...arr];if(orderAsc){res.sort(function(a,b){return(a[1]<b[1])})}else{res.sort(function(a,b){return(a[1]>b[1])})}
return res.sort(function(a,b){if(/^[\d]{2}\.[\d]{2}\.[\d]{4}$/.test(a[1])&&/^[\d]{2}\.[\d]{2}\.[\d]{4}$/.test(b[1])){return DataTableSort.sortDate(a[1],b[1],orderAsc)}else{return DataTableSort.sortString(a,b,orderAsc)}})}
static sortDate=(a,b,orderAsc)=>{const aDate=a.split('.');const bDate=b.split('.');if(aDate.length>2&&bDate.length>2){if(aDate[2]*1!==bDate[2]*1){return(!orderAsc)?aDate[2]*1>bDate[2]*1:aDate[2]*1<bDate[2]*1}else{if(aDate[1]*1!==bDate[1]*1){return(!orderAsc)?aDate[1]*1>bDate[1]*1:aDate[1]*1<bDate[1]*1}else{if(aDate[0]*1!==bDate[0]*1){return(!orderAsc)?aDate[0]*1>bDate[0]*1:aDate[0]*1<bDate[0]*1}}}}
return!1};static sortString(a,b,orderAsc){const arr0=(a[1])?a[1].toLowerCase().match(/[^\W*]/g):"";const arr1=(b[1])?b[1].toLowerCase().match(/[^\W*]/g):"";let res0="";let res1="";for(let i=0;i<arr0.length;i++){if(/^[\d]$/.test(arr0[i])&&/^[\d]$/.test(arr1[i])){const objNr0=this.getStrNumber(i,arr0);const objNr1=this.getStrNumber(i,arr1);let n0=objNr0.res*1;let n1=objNr1.res*1;if(n0===n1){if(objNr0.nextChar!==null&&objNr1.nextChar===null){n0=1;n1=0}else if(objNr1.nextChar!==null&&objNr0.nextChar===null){n0=0;n1=1}}
return(!orderAsc)?n0>n1:n0<n1}
if(arr1.length<=i&&res0===res1||arr0[i]!=arr1[i]&&/^[\d]$/.test(arr1[i])){return(!orderAsc)?1>0:1<0}else{res0=arr0[i];res1=arr1[i];if(arr0[i]!=arr1[i]){return(!orderAsc)?arr0[i]>arr1[i]:arr0[i]<arr1[i]}}}
return(!orderAsc)?res1>res0:res1<res0}};class DataTableToolBar
{constructor(DataTable,config){this.DataTable=DataTable;this.config=config}
setToolbarEvent=()=>{this.config.dom.btnShowList.onclick=()=>{this.DataTable.setDataTableCache(!0)};this.config.dom.btnShowSelct.onclick=()=>{this.DataTable.setDataTableCache(!1)};this.config.dom.btnNext.onclick=()=>{this.setStep(1)};this.config.dom.btnBack.onclick=()=>{this.setStep(0)};this.config.dom.btnStep.onclick=()=>{let intVal=this.getValidInpt({inpt:this.config.dom.inptStep,max:this.config.dataConfig.maxStep,default:this.config.dataConfig.dataStep});if(intVal!==null){this.config.dataConfig.dataStep=intVal;this.setStep(intVal,0)}};this.config.dom.btnContLen.onclick=()=>{let intVal=this.getValidInpt({inpt:this.config.dom.inptContentLength,max:this.config.dataConfig.maxLen,default:this.config.dataConfig.stepLen});if(intVal!==null){this.config.dom.inptStep.value=1;this.config.dataConfig.dataStep=1;this.DataTable.setRequest("contlen="+intVal);this.DataTable.setAjaxUrlFilter("contlen",intVal)}};this.config.dom.colToggleWrapper.onmouseenter=()=>{this.config.dom.colToggleList.style.display='block'};this.config.dom.colToggleWrapper.onmouseleave=()=>{this.config.dom.colToggleList.style.display='none'}};getValidInpt=(obj)=>{let intVal=obj.inpt.value.trim();let res=null;if(/^[\d]+$/.test(intVal)&&intVal){if(obj.max<intVal){intVal=obj.max;obj.inpt.value=intVal}
res=intVal*1}else{obj.inpt.value=obj.default}
return res};setStep=(next,isOneStep=1)=>{if(!isOneStep||next&&this.config.dataConfig.dataStep+1<=this.config.dataConfig.maxStep||!next&&this.config.dataConfig.dataStep-1>0){this.config.dataConfig.dataStep=(next)?((isOneStep)?this.config.dataConfig.dataStep+1:next):this.config.dataConfig.dataStep-1;const filter=(!this.config.ajaxUrlFilter.length)?'step='+this.config.dataConfig.dataStep:'step='+this.config.dataConfig.dataStep+"&"+this.config.ajaxUrlFilter.join('&');if(isOneStep){this.config.dom.inptStep.value=this.config.dataConfig.dataStep}
this.DataTable.setRequest(filter)}};setToolbarInfo=()=>{this.config.dom.contentInfo.innerHTML=this.config.dataConfig.actualLen+" / "+this.config.dataConfig.maxLen;this.config.dom.inptContentLength.value=this.config.dataConfig.stepLen;this.config.dom.maxStep.innerHTML=this.config.dataConfig.maxStep;this.config.dom.inptStep.value=this.config.dataConfig.dataStep}};class DataTableView
{constructor(DataTable,config){this.DataTable=DataTable;this.config=config}
setColumnSearch=(elmnt,type)=>{if(type==='mouseenter'){const col=document.createElement("div");col.className='col-search';col.innerHTML=this.config.tpl.columnSearch;elmnt.appendChild(col);this.DataTable.setHeaderSearchEvent()}else{document.getElementsByClassName("col-search")[0].remove()}};setColumnToggleList=(parent,val)=>{const col=document.createElement("div");col.setAttribute('data-col-index',this.config.dataIndex);col.className='col-toggle-list';col.innerHTML=this.config.tpl.columnToggleList.replace("{%column%}",val);parent.appendChild(col);col.onclick=()=>{this.DataTable.setColToggleEvent(col)}};setColumn=(parent,val,css,colIndex=-1)=>{const col=(css==='col-header')?document.createElement("th"):document.createElement("td");if(css==='col-header'){col.innerHTML=this.config.tpl.columnHeader.replace("{%column%}",val)}else{col.appendChild(document.createTextNode(val))}
if(css){col.className=css;if(css==='col-header'){col.setAttribute('data-col-index',this.config.dataIndex)}
if(css==='data-col'){col.setAttribute('data-col-index',colIndex);if(this.config.arrToggleList.indexOf(colIndex+"")!==-1){col.style.display="none"}}}
parent.appendChild(col)};setHeader=(arrData)=>{const tr=document.createElement("tr");const stickyBox=document.createElement("th");stickyBox.classList.add('th-sticky');stickyBox.appendChild(document.createTextNode("Zeile"));tr.appendChild(stickyBox);arrData.map((colVal)=>{this.setColumn(tr,colVal,"col-header");this.setColumnToggleList(this.config.dom.colToggleList,colVal);this.config.dataIndex++});this.config.dom.header.appendChild(tr);this.config.dataIndex=0}
setContent=(val)=>{let colIndex=0;let rowIndex=(this.config.dataConfig.stepLen==this.config.dataConfig.actualLen)?this.config.dataIndex+1:(this.config.dataConfig.actualLen-this.config.dataConfig.rowLen)+(this.config.dataIndex);const tr=document.createElement("tr");const stickyBox=document.createElement("td");stickyBox.innerHTML=this.config.tpl.rowIndex.replace('{%rowIndex%}',rowIndex);stickyBox.classList.add('td-sticky');tr.className="data-row";tr.setAttribute(tr.className+'-index',(this.config.arrRowIndex.length)?this.config.arrRowIndex[this.config.dataIndex]:this.config.dataIndex);tr.appendChild(stickyBox);val.map((colVal)=>{this.setColumn(tr,colVal,"data-col",colIndex++)});this.config.dom.content.appendChild(tr);this.config.dataIndex++};setContentUpdate=(activList)=>{let index=0;this.config.dom.content.querySelectorAll('.data-row').forEach((row)=>{if(activList.length){if(activList.indexOf(index)===-1){row.style.display='none'}
index++}else{row.removeAttribute('style')}});this.resetOrder()};setContentSelection=()=>{let setOk=!1;if(this.config.arrRowList.length){this.config.dom.content.querySelectorAll('.data-row').forEach((row)=>{if(this.config.arrRowList.indexOf(row.dataset.rowIndex)===-1){row.style.display='none'}else{row.classList.toggle('active')}});setOk=!0}
return setOk};setColumnUpdate=(colIndex,hide)=>{this.config.dom.content.querySelectorAll('.data-row').forEach((row)=>{if(hide){this.config.dom.header.getElementsByClassName("col-header")[colIndex].style.display="none";row.getElementsByClassName("data-col")[colIndex].style.display="none"}else{this.config.dom.header.getElementsByClassName("col-header")[colIndex].removeAttribute('style');row.getElementsByClassName("data-col")[colIndex].removeAttribute('style')}})};getClosest=(selector,obj)=>{if(obj.parentElement.hasAttribute("class")&&obj.parentElement.getAttribute("class")===selector){return obj.parentElement}else{if(obj.parentElement.nodeName.toLowerCase()!=='body'){return this.getClosest(selector,obj.parentElement)}else{return null}}};resetOrder=()=>{if(this.config.dom.header.querySelector('span.svg-arrow-item.active')){this.config.dom.header.querySelector('span.svg-arrow-item.active').classList.toggle('active');this.config.objSortList={}}}}